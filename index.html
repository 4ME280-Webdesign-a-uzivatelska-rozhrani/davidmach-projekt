<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PF 2026 — FIS VŠE</title>
<style>
  body {
    background-color: #000;
    color: #00b050;
    font-family: "Courier New", monospace;
    margin: 0;
    padding: 20px;
    transition: background-color 0.2s;
  }

  #terminal {
    white-space: pre-wrap;
    line-height: 1.3em;
    position: relative;
  }

  #cursor {
    display: inline-block;
    width: 8px;
    height: 1em;
    background-color: #00b050;
    animation: blink 1s steps(1) infinite;
    vertical-align: bottom;
  }

  @keyframes blink { 50% { opacity: 0; } }

  #finalImage {
    display: none;
    margin-top: 20px;
    max-width: 100%;
    border: 2px solid #00b050;
    border-radius: 5px;
  }

  #pressKey {
    margin-top: 20px;
    color: #ffffff;
    font-size: 0.9em;
    display: none;
  }

  .flash { background-color: #00ff66 !important; }
</style>
</head>
<body>
<div id="terminal"></div>
<div id="pressKey">Press any key to continue...</div>
<img id="finalImage" src="placeholder.png" alt="PF FIS 2026">

<script>
const terminal = document.getElementById("terminal");
const finalImage = document.getElementById("finalImage");
const pressKey = document.getElementById("pressKey");

// ---------- Texty ----------
const introLines = [
  "C:\\FIS> run PF2026.exe",
  "Initializing PF2026.exe ...",
  "Connecting to FIS mainframe ...",
  "Compiling data happiness.dll ... ok",
  "Loading joy modules ........... done",
  "Rendering festive vibes ...",
  "PF 2026 — Faculty of Informatics and Statistics"
];

const cursor = document.createElement("span");
cursor.id = "cursor";
terminal.appendChild(cursor);

// ---------- Zvuk ----------
const clickAudioUrl = "https://cdn.pixabay.com/download/audio/2022/03/15/audio_5bfb7b0f24.mp3?filename=typewriter-key-1-117234.mp3";
let audioCtx, buffer;

async function initAudio() {
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const response = await fetch(clickAudioUrl);
    const arrayBuffer = await response.arrayBuffer();
    buffer = await audioCtx.decodeAudioData(arrayBuffer);
  } catch (e) {
    console.warn("Audio init failed", e);
  }
}

function playClick() {
  if (!audioCtx || !buffer) return;
  const source = audioCtx.createBufferSource();
  source.buffer = buffer;
  source.connect(audioCtx.destination);
  source.start();
}

// ---------- Efekt psaní ----------
function typeLine(line, delay = 40) {
  return new Promise(resolve => {
    let i = 0;
    function next() {
      if (i < line.length) {
        cursor.insertAdjacentText("beforebegin", line[i]);
        playClick();
        i++;
        setTimeout(next, delay);
      } else {
        cursor.insertAdjacentText("beforebegin", "\n");
        resolve();
      }
    }
    next();
  });
}

// ---------- Spuštění úvodní sekvence ----------
async function runIntro() {
  for (const line of introLines) {
    await typeLine(line);
    await new Promise(r => setTimeout(r, 300));
  }
  pressKey.style.display = "block";
  await initAudio();
  document.body.addEventListener("click", continueSequence);
  document.body.addEventListener("keydown", continueSequence);
}

// ---------- Pokračování po kliku ----------
async function continueSequence() {
  pressKey.style.display = "none";
  document.body.removeEventListener("click", continueSequence);
  document.body.removeEventListener("keydown", continueSequence);
  await showLoadingBar();
}

// ---------- Loading bar ----------
async function showLoadingBar() {
  const barLine = document.createElement("div");
  terminal.appendChild(barLine);

  let progress = 0;
  const total = 30;

  const interval = setInterval(() => {
    if (progress < total) {
      barLine.textContent = `Loading final image: [${"=".repeat(progress)}${" ".repeat(total - progress)}] ${Math.floor((progress / total)*100)}%`;
      playClick();
      progress++;
    } else {
      clearInterval(interval);
      barLine.textContent = `Loading final image: [${"=".repeat(total)}] 100%\n`;
      flashScreen();
    }
  }, 100);
}

// ---------- Bliknutí + obrázek ----------
function flashScreen() {
  document.body.classList.add("flash");
  setTimeout(() => {
    document.body.classList.remove("flash");
    finalImage.style.display = "block";
  }, 150);
}

// ---------- Spuštění po načtení ----------
win
